---
// src/pages/category/index.astro
import Layout from '../../layouts/BaseLayout.astro';
import { getAllVideos } from '../../utils/data';
import { slugify } from '../../utils/slugify';
import { nama } from '../../utils/site.ts';
export const prerender = true;

const allVideos = await getAllVideos();

// Mendapatkan daftar kategori unik dan menghitung jumlah video per kategori
const categoryCounts: { [key: string]: number } = {};
allVideos.forEach(video => {
  categoryCounts[video.category] = (categoryCounts[video.category] || 0) + 1;
});

// Konversi ke array objek untuk iterasi dan urutkan
const categories = Object.keys(categoryCounts)
  .map(categoryName => ({
    name: categoryName,
    count: categoryCounts[categoryName],
    slug: slugify(categoryName),
  }))
  .sort((a, b) => a.name.localeCompare(b.name)); // Urutkan berdasarkan nama kategori

const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: 'Category', url: '/category/' },
];
---

<Layout
  title={`Daftar Category Video | ${nama}`}
  description={`Jelajahi berbagai Category video yang tersedia di ${nama}`}
>
  <main class="categories-list-page">
    <nav class="breadcrumb" aria-label="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
      <ol>
        {breadcrumbs.map((item, index) => (
          <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            {index > 0 && <span class="separator">/</span>}
            {item.url ? (
              <a itemprop="item" href={item.url}>
                <span itemprop="name">{item.name}</span>
              </a>
            ) : (
              <span itemprop="name">{item.name}</span>
            )}
            <meta itemprop="position" content={(index + 1).toString()} />
          </li>
        ))}
      </ol>
    </nav>

    <h1 class="page-title">Semua Kategori Video</h1>

    {categories.length === 0 ? (
      <p class="no-categories">Tidak ada kategori video yang tersedia saat ini.</p>
    ) : (
      <div class="category-list">
        {categories.map(category => (
          <a href={`/category/${category.slug}/1`} class="category-item">
            <h2 class="category-item-title">{category.name}</h2>
            <p class="category-item-count">{category.count} Video</p>
          </a>
        ))}
      </div>
    )}
  </main>
</Layout>
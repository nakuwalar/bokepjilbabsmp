---
// src/pages/category/[category].astro
import Layout from '../../layouts/Layout.astro';
import VideoCard from '../../components/VideoCard.astro';
import videosData from '../../data/videos.json';

const VIDEOS_PER_PAGE = 20; // Atur jumlah video per halaman

export async function getStaticPaths() {
  const categories = [...new Set(videosData.map(video => video.category))]; // Ambil kategori unik

  let paths = [];
  for (const category of categories) {
    const slug = encodeURIComponent(category.toLowerCase().replace(/\s+/g, '-'));
    const filteredVideos = videosData.filter(video => video.category === category);
    const totalPages = Math.ceil(filteredVideos.length / VIDEOS_PER_PAGE);

    for (let i = 1; i <= totalPages; i++) {
      paths.push({
        params: { category: slug },
        props: {
          currentPage: i,
          categoryName: category,
          videos: filteredVideos.slice((i - 1) * VIDEOS_PER_PAGE, i * VIDEOS_PER_PAGE),
          totalPages: totalPages,
        }
      });
    }
  }
  return paths;
}

const { category } = Astro.params;
const { currentPage, categoryName, videos, totalPages } = Astro.props;

const prevPage = currentPage > 1 ? `/category/${category}/page/${currentPage - 1}/` : null;
const nextPage = currentPage < totalPages ? `/category/${category}/page/${currentPage + 1}/` : null;

// Untuk canonical URL pada halaman paginasi
const canonicalUrl = currentPage === 1
  ? `/category/${category}/`
  : `/category/${category}/page/${currentPage}/`;
---

<Layout
  title={`Video Kategori: ${categoryName} (Halaman ${currentPage})`}
  description={`Jelajahi semua video dalam kategori ${categoryName} di Astro Video. Halaman ${currentPage} dari ${totalPages}.`}
>
  <h1 class="text-4xl font-bold mb-8 text-center">Kategori: {categoryName}</h1>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
    {videos.map((video) => (
      <VideoCard {...video} />
    ))}
  </div>

  <nav class="flex justify-center items-center space-x-4 mt-12">
    {prevPage && (
      <a href={prevPage} class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300">
        &larr; Sebelumnya
      </a>
    )}
    <span class="text-lg font-medium">Halaman {currentPage} dari {totalPages}</span>
    {nextPage && (
      <a href={nextPage} class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300">
        Selanjutnya &rarr;
      </a>
    )}
  </nav>

  <link rel="canonical" href={new URL(canonicalUrl, Astro.site).href} />
  {prevPage && <link rel="prev" href={new URL(prevPage, Astro.site).href} />}
  {nextPage && <link rel="next" href={new URL(nextPage, Astro.site).href} />}
</Layout>